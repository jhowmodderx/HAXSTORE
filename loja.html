<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HAX STORE</title>
  <style>
    /* Reset e base */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: Arial, sans-serif; background-color: #0c0c0c; color: #fff; line-height: 1.6; }

    /* Header */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #111;
      padding: 15px 20px;
      border-bottom: 2px solid #e50914;
    }

    .logo { color: #e50914; font-size: 22px; font-weight: bold; }

    .header-buttons {
        display: flex;
        gap: 10px; /* Espaçamento entre os botões */
    }

    .discord-btn, .admin-panel-btn {
      background: transparent;
      border: 2px solid #e50914;
      color: #e50914;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      transition: 0.3s;
    }

    .discord-btn:hover, .admin-panel-btn:hover {
      background-color: #e50914;
      color: white;
    }

    /* Banner */
    .banner {
      height: 250px;
      background: url('https://i.imgur.com/xklvTL7.png') no-repeat center center; /* Imagem do banner */
      background-size: cover;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }

    .banner h2 {
      background-color: rgba(0, 0, 0, 0.6);
      border: 2px solid #e50914;
      color: #e50914;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 24px;
      font-weight: bold;
    }

    /* Conteúdo principal */
    .content {
      padding: 30px 20px;
      max-width: 900px;
      margin: 0 auto;
    }

    /* Tag de destaque */
    .tag {
      display: inline-block;
      background-color: #e50914;
      color: white;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 12px;
      text-transform: uppercase;
      margin-bottom: 10px;
    }

    /* Item de produto */
    .produto-item {
      background-color: #1a1a1a;
      border: 1px solid #222;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 8px;
      position: relative;
    }

    .produto-titulo { font-size: 28px; font-weight: bold; margin: 10px 0; color: #e50914;}
    .produto-desc { color: #ccc; margin-bottom: 15px; }

    .precos { margin-bottom: 15px; }
    .preco-antigo { text-decoration: line-through; color: #888; font-size: 16px; margin-right: 10px; }
    .preco-atual { color: #0f0; font-size: 28px; font-weight: bold; } /* Preço atual em verde */

    .btn-comprar {
      background-color: #e50914;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 6px;
      cursor: pointer;
      transition: 0.3s;
    }

    .btn-comprar:hover {
      background-color: #b20710;
    }

    /* Botões de Admin no produto (só aparecem para admin) */
    .btn-delete-produto {
      background-color: #cc0000;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 12px;
      transition: 0.2s;
    }
    .btn-delete-produto:hover { background-color: #990000; }

    .btn-edit-produto {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
      position: absolute;
      top: 10px;
      right: 70px; /* Ajuste para não sobrepor o delete */
      font-size: 12px;
      transition: 0.2s;
    }
    .btn-edit-produto:hover { background-color: #0056b3; }


    /* Footer */
    footer {
      background-color: #111;
      text-align: center;
      padding: 15px;
      color: #777;
      margin-top: 40px;
      font-size: 14px;
    }

    /* Modals base */
    .modal {
      display: none; /* Escondido por padrão */
      position: fixed;
      z-index: 1000;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      justify-content: center;
      align-items: center;
      overflow: auto; /* Para modais altos em telas pequenas */
    }

    .modal-content {
      background-color: #111;
      padding: 25px;
      border-radius: 10px;
      text-align: center;
      width: 90%;
      max-width: 450px; /* Largura padrão */
      border: 2px solid #e50914; /* Borda vermelha para modal de compra */
      position: relative;
      animation: fadeIn 0.3s ease-out;
    }

    .modal-content.admin-modal {
        max-width: 700px; /* Mais largo para o painel de admin */
        border: 2px solid #0f0; /* Borda verde para o modal admin */
    }

    .modal-content h3 {
      color: #e50914;
      margin-bottom: 20px;
      font-size: 24px;
    }
    .modal-content.admin-modal h3 {
        color: #0f0; /* Título do modal admin verde */
    }

    .pix-key {
      background-color: #222;
      padding: 12px;
      border-radius: 6px;
      font-size: 16px;
      word-wrap: break-word; /* Quebra texto longo */
      margin-bottom: 20px;
      border: 1px solid #e50914;
    }

    .btn-confirmar {
      background-color: #e50914;
      border: none;
      color: white;
      padding: 12px 25px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      transition: 0.3s;
    }
    .btn-confirmar:hover { background-color: #b20710; }

    .mensagem-final {
      margin-top: 25px;
      color: #0f0;
      font-weight: bold;
      font-size: 18px;
      display: none;
    }

    .close-button {
      position: absolute;
      top: 10px;
      right: 20px;
      color: #aaa;
      font-size: 30px;
      font-weight: bold;
      cursor: pointer;
      transition: 0.2s;
    }
    .close-button:hover, .close-button:focus {
      color: #fff;
    }

    /* Estilos de Administração (dentro do modal) */
    .admin-tab-content h4 {
        color: #eee;
        margin-top: 25px;
        margin-bottom: 15px;
        font-size: 20px;
        border-bottom: 1px solid #333;
        padding-bottom: 5px;
    }

    .admin-section input[type="text"],
    .admin-section input[type="number"],
    .admin-section textarea {
      width: calc(100% - 20px);
      padding: 10px;
      margin-bottom: 10px;
      background-color: #222;
      border: 1px solid #333;
      color: #fff;
      border-radius: 4px;
      font-size: 15px;
    }

    .admin-section button {
      background-color: #0f0; /* Botão verde */
      color: #111;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin-right: 10px;
      transition: 0.3s;
      font-size: 15px;
    }

    .admin-section button:hover {
      background-color: #00cc00;
    }

    .admin-products-list, .admin-warnings-list {
      margin-top: 20px;
      max-height: 250px; /* Limita a altura para rolagem */
      overflow-y: auto; /* Adiciona barra de rolagem se necessário */
      padding-right: 10px; /* Espaço para a barra de rolagem */
      border-top: 1px solid #333;
      padding-top: 15px;
    }

    .admin-product-item, .warning-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #222;
      padding: 12px;
      border-radius: 5px;
      margin-bottom: 10px;
      border: 1px solid #333;
    }

    .admin-product-item span, .warning-item span {
      flex-grow: 1;
      text-align: left;
      font-size: 15px;
    }

    .admin-product-item button, .warning-item button {
      margin-left: 10px;
      padding: 5px 10px;
      font-size: 13px;
      flex-shrink: 0;
    }

    .admin-warning-message {
        background-color: #e50914;
        color: white;
        padding: 10px;
        border-radius: 5px;
        margin-bottom: 20px;
        text-align: center;
        font-weight: bold;
        font-size: 16px;
    }

    /* Estilos para as abas de administração */
    .admin-tabs {
        display: flex;
        margin-bottom: 20px;
        border-bottom: 1px solid #0f0;
        overflow-x: auto; /* Permite rolagem horizontal se muitas abas */
    }

    .admin-tab-button {
        background-color: #333;
        color: #0f0;
        padding: 10px 15px;
        border: none;
        cursor: pointer;
        border-top-left-radius: 8px;
        border-top-right-radius: 8px;
        margin-right: 5px;
        transition: background-color 0.3s, color 0.3s;
        flex-shrink: 0; /* Evita que os botões encolham */
    }

    .admin-tab-button.active {
        background-color: #0f0;
        color: #111;
    }

    .admin-tab-content {
        display: none;
        text-align: left;
        padding-top: 15px; /* Espaço após as abas */
    }

    .admin-tab-content.active {
        display: block;
    }

    /* Animação para modal */
    @keyframes fadeIn {
        from { opacity: 0; transform: scale(0.9); }
        to { opacity: 1; transform: scale(1); }
    }
  </style>
</head>
<body>

  <header>
    <div class="logo">HAX STORE</div>
    <div class="header-buttons">
        <button class="discord-btn" onclick="window.open('https://discord.gg/SEU_CONVITE_DISCORD', '_blank')">Entrar no Discord</button>
        <button id="adminPanelBtn" class="admin-panel-btn" style="display: none;">Painel de Administração</button>
    </div>
  </header>

  <div class="banner">
    <h2>Bem-vindo à HAX STORE!</h2>
  </div>

  <div class="content">
    <div id="warnings-container">
      </div>
    <div id="products-container">
      </div>
  </div>

  <footer>
    &copy; 2025 HAX STORE. Todos os direitos reservados.
  </footer>

  <div class="modal" id="pixModal">
    <div class="modal-content">
      <span class="close-button" onclick="closePixModal()">&times;</span>
      <h3>Pagamento via PIX</h3>
      <p>Escaneie o QR Code ou use a chave PIX abaixo:</p>
      <div class="pix-key" id="pixChave"></div> <button class="btn-confirmar" onclick="confirmarPagamento()">Já realizei o pagamento</button>
      <div class="mensagem-final" id="mensagemFinal">HAX STORE - ENVIE O COMPROVANTE NO TICKET DO DISCORD!</div>
    </div>
  </div>

  <div class="modal" id="adminModal">
    <div class="modal-content admin-modal">
        <span class="close-button" onclick="closeAdminModal()">&times;</span>
        <h3>Painel de Administração</h3>

        <div class="admin-tabs">
            <button class="admin-tab-button active" onclick="openAdminTab(event, 'manage-products')">Gerenciar Produtos</button>
            <button class="admin-tab-button" onclick="openAdminTab(event, 'manage-warnings')">Gerenciar Avisos</button>
            <button class="admin-tab-button" onclick="openAdminTab(event, 'manage-pix')">Configurar PIX</button>
        </div>

        <div id="manage-products" class="admin-tab-content active admin-section">
            <h4>Adicionar/Editar Produto</h4>
            <input type="hidden" id="productIdToEdit">
            <input type="text" id="productTitle" placeholder="Título do Produto" required>
            <textarea id="productDesc" placeholder="Descrição do Produto" rows="3"></textarea>
            <input type="number" id="productOldPrice" placeholder="Preço Antigo (Ex: 30.00)" step="0.01">
            <input type="number" id="productNewPrice" placeholder="Preço Atual (Ex: 10.00)" step="0.01" required>
            <button onclick="saveProduct()">Salvar Produto</button>
            <button onclick="clearProductForm()">Limpar Formulário</button>

            <h4>Produtos Existentes</h4>
            <div id="admin-products-list">
            </div>
        </div>

        <div id="manage-warnings" class="admin-tab-content admin-section">
            <h4>Gerenciar Avisos</h4>
            <input type="text" id="warningMessage" placeholder="Nova mensagem de aviso">
            <button onclick="addWarning()">Adicionar Aviso</button>
            <div id="admin-warnings-list">
            </div>
        </div>

        <div id="manage-pix" class="admin-tab-content admin-section">
            <h4>Chave PIX Atual</h4>
            <input type="text" id="currentPixKey" placeholder="Chave PIX atual" readonly>
            <h4>Nova Chave PIX</h4>
            <input type="text" id="newPixKey" placeholder="Nova Chave PIX">
            <button onclick="updatePixKey()">Salvar Chave PIX</button>
        </div>
    </div>
  </div>

  <script>
    // Referências aos elementos DOM
    const productsContainer = document.getElementById('products-container');
    const adminPanelBtn = document.getElementById('adminPanelBtn');
    const adminModal = document.getElementById('adminModal');
    const adminProductsList = document.getElementById('admin-products-list');
    const warningsContainer = document.getElementById('warnings-container');
    const adminWarningsList = document.getElementById('admin-warnings-list');
    const pixChaveDisplay = document.getElementById('pixChave'); // No modal de compra
    const newPixKeyInput = document.getElementById('newPixKey'); // No painel admin
    const currentPixKeyDisplay = document.getElementById('currentPixKey'); // No painel admin

    // --- Funções de Inicialização e Verificação de Admin ---
    document.addEventListener('DOMContentLoaded', () => {
        const isAdmin = localStorage.getItem('isAdmin') === 'true';

        // Log para depuração: verifica o status de admin
        console.log("HAX STORE: Usuário logado é Admin?", isAdmin);

        if (isAdmin) {
            adminPanelBtn.style.display = 'block'; // Mostra o botão "Painel de Administração"
        } else {
            adminPanelBtn.style.display = 'none'; // Garante que o botão esteja oculto para não-admins
        }

        // *** ESSAS FUNÇÕES SÃO SEMPRE CHAMADAS AO CARREGAR A PÁGINA PARA EXIBIR O CONTEÚDO ***
        renderProducts(); // Carrega e exibe os produtos na loja para TODOS os usuários
        renderWarnings(); // Carrega e exibe os avisos na loja para TODOS os usuários
        updatePixKeyDisplay(); // Atualiza a chave PIX no modal de compra
    });

    // --- Funções de Modal de Compra (PIX) ---
    function abrirModal() {
      // Verifica se há um usuário logado antes de abrir o modal
      if (!localStorage.getItem('loggedUser')) {
        alert('Você precisa estar logado para realizar uma compra.');
        window.location.href = 'index.html'; // Redireciona para o login
        return;
      }
      updatePixKeyDisplay(); // Garante que a chave PIX no modal está atualizada
      document.getElementById('pixModal').style.display = 'flex';
      document.getElementById('mensagemFinal').style.display = "none"; // Reseta a mensagem
    }

    function closePixModal() {
      document.getElementById('pixModal').style.display = 'none';
      document.getElementById('mensagemFinal').style.display = "none";
    }

    function confirmarPagamento() {
      const mensagem = document.getElementById('mensagemFinal');
      mensagem.style.display = 'block';
      // Poderia adicionar lógica aqui para fechar o modal automaticamente após X segundos, etc.
    }

    // --- Funções do Modal de Administração ---
    adminPanelBtn.addEventListener('click', () => {
        // Apenas abre o modal se o usuário for realmente admin (segurança extra)
        if (localStorage.getItem('isAdmin') === 'true') {
            adminModal.style.display = 'flex';
            // Ao abrir o modal, garantimos que a aba de produtos esteja ativa e os dados carregados
            openAdminTab(null, 'manage-products'); // Passa null para evt, ativa a primeira aba
            loadAdminProducts();
            loadAdminWarnings();
            loadPixKeyForAdmin();
        } else {
            alert('Acesso negado. Você não tem permissões de administrador.');
        }
    });

    function closeAdminModal() {
      adminModal.style.display = 'none';
    }

    // Fecha modais ao clicar fora (geral para ambos os modais)
    window.addEventListener('click', function(event) {
      if (event.target == document.getElementById('pixModal')) {
        closePixModal();
      }
      if (event.target == document.getElementById('adminModal')) {
        closeAdminModal();
      }
    });
    
    // --- Funções de Gerenciamento de Produtos ---
    function getProducts() {
      // Retorna os produtos do localStorage, ou um array vazio se não houver
      return JSON.parse(localStorage.getItem('products') || '[]');
    }

    function saveProducts(products) {
      localStorage.setItem('products', JSON.stringify(products));
    }

    // Renderiza produtos na parte principal da loja (visível para todos)
    function renderProducts() {
      const products = getProducts();
      productsContainer.innerHTML = ''; // Limpa o container antes de renderizar
      const isAdmin = localStorage.getItem('isAdmin') === 'true';

      if (products.length === 0) {
          productsContainer.innerHTML = '<p style="text-align: center; color: #ccc; padding: 20px;">Nenhum produto disponível no momento.</p>';
          // Mensagem extra para admin quando não há produtos
          if (isAdmin) {
              productsContainer.innerHTML += '<p style="text-align: center; color: #0f0;">Como administrador, você pode adicionar produtos através do "Painel de Administração".</p>';
          }
          return; // Sai da função se não houver produtos para evitar processamento desnecessário
      }

      // Se há produtos, renderiza-os
      products.forEach((product, index) => {
        const productDiv = document.createElement('div');
        productDiv.className = 'produto-item';
        productDiv.innerHTML = `
          <span class="tag">Em destaque</span>
          <h1 class="produto-titulo">${product.title}</h1>
          <p class="produto-desc">${product.description}</p>
          <div class="precos">
            ${product.oldPrice && product.oldPrice > 0 ? `<span class="preco-antigo">R$ ${product.oldPrice.toFixed(2).replace('.', ',')}</span>` : ''}
            <span class="preco-atual">R$ ${product.newPrice.toFixed(2).replace('.', ',')}</span>
          </div>
          <button class="btn-comprar">Comprar agora</button>
        `;
        productsContainer.appendChild(productDiv);
      });

      // Adiciona event listeners para os botões de compra (após a renderização)
      document.querySelectorAll('.btn-comprar').forEach(button => {
        button.addEventListener('click', abrirModal);
      });
    }

    // Carrega produtos na lista dentro do painel de administração (só admin)
    function loadAdminProducts() {
        if (localStorage.getItem('isAdmin') !== 'true') return; // Segurança extra

        const products = getProducts();
        adminProductsList.innerHTML = ''; // Limpa a lista antes de carregar
        if (products.length === 0) {
            adminProductsList.innerHTML = '<p style="color: #888;">Nenhum produto cadastrado. Adicione um novo acima!</p>';
            return;
        }
        products.forEach((product, index) => {
            const productItem = document.createElement('div');
            productItem.className = 'admin-product-item';
            productItem.innerHTML = `
                <span>${product.title} - R$ ${product.newPrice.toFixed(2).replace('.', ',')}</span>
                <div>
                    <button class="btn-edit-produto" onclick="editProduct(${index})">Editar</button>
                    <button class="btn-delete-produto" onclick="deleteProduct(${index})">Apagar</button>
                </div>
            `;
            adminProductsList.appendChild(productItem);
        });
    }

    function saveProduct() {
        if (localStorage.getItem('isAdmin') !== 'true') { alert('Acesso negado.'); return; } // Segurança extra

        const idToEdit = document.getElementById('productIdToEdit').value;
        const title = document.getElementById('productTitle').value.trim();
        const description = document.getElementById('productDesc').value.trim();
        const oldPrice = parseFloat(document.getElementById('productOldPrice').value) || 0;
        const newPrice = parseFloat(document.getElementById('productNewPrice').value);

        if (!title || !description || isNaN(newPrice) || newPrice <= 0) {
            alert('Por favor, preencha todos os campos obrigatórios (Título, Descrição, Preço Atual) e o preço deve ser um número positivo.');
            return;
        }

        const products = getProducts();
        if (idToEdit !== '') { // Se productIdToEdit não estiver vazio, estamos editando
            products[idToEdit] = { title, description, oldPrice, newPrice };
        } else { // Caso contrário, estamos adicionando um novo
            products.push({ title, description, oldPrice, newPrice });
        }
        saveProducts(products);
        clearProductForm(); // Limpa o formulário após salvar
        renderProducts(); // Atualiza a exibição da loja para os usuários
        loadAdminProducts(); // Atualiza a lista no painel admin
        alert('Produto salvo com sucesso!');
    }

    function editProduct(index) {
        if (localStorage.getItem('isAdmin') !== 'true') { alert('Acesso negado.'); return; } // Segurança extra
        const products = getProducts();
        const product = products[index];
        document.getElementById('productIdToEdit').value = index; // Armazena o índice para edição
        document.getElementById('productTitle').value = product.title;
        document.getElementById('productDesc').value = product.description;
        document.getElementById('productOldPrice').value = product.oldPrice;
        document.getElementById('productNewPrice').value = product.newPrice;
    }

    function deleteProduct(index) {
        if (localStorage.getItem('isAdmin') !== 'true') { alert('Acesso negado.'); return; } // Segurança extra
        if (confirm('Tem certeza que deseja apagar este produto?')) {
            const products = getProducts();
            products.splice(index, 1); // Remove o produto do array
            saveProducts(products);
            renderProducts(); // Atualiza a exibição da loja para os usuários
            loadAdminProducts(); // Atualiza a lista no painel admin
            alert('Produto apagado com sucesso!');
        }
    }

    function clearProductForm() {
        document.getElementById('productIdToEdit').value = ''; // Limpa o índice de edição
        document.getElementById('productTitle').value = '';
        document.getElementById('productDesc').value = '';
        document.getElementById('productOldPrice').value = '';
        document.getElementById('productNewPrice').value = '';
    }

    // --- Funções de Gerenciamento de Avisos ---
    function getWarnings() {
      return JSON.parse(localStorage.getItem('warnings') || '[]');
    }

    function saveWarnings(warnings) {
      localStorage.setItem('warnings', JSON.stringify(warnings));
    }

    // Renderiza avisos na parte principal da loja (visível para todos)
    function renderWarnings() {
        const warnings = getWarnings();
        warningsContainer.innerHTML = '';
        if (warnings.length === 0) {
            warningsContainer.innerHTML = '<p style="text-align: center; color: #ccc; padding: 10px;">Nenhum aviso no momento.</p>';
            return;
        }
        warnings.forEach((warning) => {
            const warningDiv = document.createElement('div');
            warningDiv.className = 'admin-warning-message';
            warningDiv.textContent = warning;
            warningsContainer.appendChild(warningDiv);
        });
    }

    // Carrega avisos na lista dentro do painel de administração (só admin)
    function loadAdminWarnings() {
        if (localStorage.getItem('isAdmin') !== 'true') return; // Segurança extra

        const warnings = getWarnings();
        adminWarningsList.innerHTML = '';
        if (warnings.length === 0) {
            adminWarningsList.innerHTML = '<p style="color: #888;">Nenhum aviso cadastrado. Adicione um novo acima!</p>';
            return;
        }
        warnings.forEach((warning, index) => {
            const warningItem = document.createElement('div');
            warningItem.className = 'warning-item';
            warningItem.innerHTML = `
                <span>${warning}</span>
                <button class="btn-delete-produto" onclick="deleteWarning(${index})">Apagar</button>
            `;
            adminWarningsList.appendChild(warningItem);
        });
    }

    function addWarning() {
        if (localStorage.getItem('isAdmin') !== 'true') { alert('Acesso negado.'); return; } // Segurança extra

        const message = document.getElementById('warningMessage').value.trim();
        if (!message) {
            alert('Por favor, digite uma mensagem para o aviso.');
            return;
        }
        const warnings = getWarnings();
        warnings.push(message);
        saveWarnings(warnings);
        document.getElementById('warningMessage').value = '';
        renderWarnings(); // Atualiza a exibição da loja
        loadAdminWarnings(); // Atualiza a lista no painel admin
        alert('Aviso adicionado com sucesso!');
    }

    function deleteWarning(index) {
        if (localStorage.getItem('isAdmin') !== 'true') { alert('Acesso negado.'); return; } // Segurança extra

        if (confirm('Tem certeza que deseja apagar este aviso?')) {
            const warnings = getWarnings();
            warnings.splice(index, 1);
            saveWarnings(warnings);
            renderWarnings(); // Atualiza a exibição da loja
            loadAdminWarnings(); // Atualiza a lista no painel admin
            alert('Aviso apagado com sucesso!');
        }
    }

    // --- Funções de Configuração de PIX ---
    function getPixKey() {
        // Retorna a chave PIX, ou uma padrão se não houver (ex: uma chave genérica da loja)
        return localStorage.getItem('pixKey') || '473d4931-6f15-4ab6-bf59-571f6c3a368d'; // Chave PIX padrão
    }

    function savePixKey(key) {
        localStorage.setItem('pixKey', key);
    }

    // Atualiza a chave PIX exibida no modal de compra para o usuário final
    function updatePixKeyDisplay() {
        pixChaveDisplay.textContent = getPixKey();
    }

    // Carrega a chave PIX no campo de texto para o admin no modal de administração (só admin)
    function loadPixKeyForAdmin() {
        if (localStorage.getItem('isAdmin') !== 'true') return; // Segurança extra
        currentPixKeyDisplay.value = getPixKey();
    }

    function updatePixKey() {
        if (localStorage.getItem('isAdmin') !== 'true') { alert('Acesso negado.'); return; } // Segurança extra

        const newKey = newPixKeyInput.value.trim();
        if (!newKey) {
            alert('Por favor, digite uma nova chave PIX.');
            return;
        }
        savePixKey(newKey);
        newPixKeyInput.value = ''; // Limpa o campo de nova chave
        currentPixKeyDisplay.value = newKey; // Atualiza o campo de visualização no admin
        updatePixKeyDisplay(); // Garante que a chave no modal de compra seja atualizada
        alert('Chave PIX atualizada com sucesso!');
    }

    // --- Funções de Abas do Painel de Administração ---
    function openAdminTab(evt, tabName) {
        if (localStorage.getItem('isAdmin') !== 'true') return; // Segurança extra

        let i, tabcontent, tablinks;
        // Oculta todas as abas de conteúdo
        tabcontent = adminModal.getElementsByClassName("admin-tab-content");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        // Remove a classe 'active' de todos os botões de aba
        tablinks = adminModal.getElementsByClassName("admin-tab-button");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        // Exibe o conteúdo da aba selecionada
        document.getElementById(tabName).style.display = "block";
        // Adiciona a classe 'active' ao botão da aba clicada
        if (evt) { // Se a função foi chamada por um evento de clique
            evt.currentTarget.className += " active";
        } else { // Se a função foi chamada programaticamente (ex: ao abrir o modal)
            // Encontra o botão da aba padrão e o ativa manualmente
            const defaultButton = adminModal.querySelector(`.admin-tab-button[onclick*="'${tabName}'"]`);
            if (defaultButton) {
                defaultButton.className += " active";
            }
        }
    }
  </script>

</body>
</html>