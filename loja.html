<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HAX STORE</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <style>
    /* Reset e base */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: Arial, sans-serif; background-color: #0c0c0c; color: #fff; line-height: 1.6; }

    /* Header */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #111;
      padding: 15px 20px;
      border-bottom: 2px solid #e50914;
    }

    .logo { color: #e50914; font-size: 22px; font-weight: bold; }

    .header-buttons {
        display: flex;
        gap: 10px; /* Espaçamento entre os botões */
    }

    .discord-btn, .admin-panel-btn, .logout-btn {
      background: transparent;
      border: 2px solid #e50914;
      color: #e50914;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      transition: 0.3s;
    }

    .discord-btn:hover, .admin-panel-btn:hover, .logout-btn:hover {
      background-color: #e50914;
      color: white;
    }

    /* Banner */
    .banner {
      height: 250px;
      background: url('https://i.imgur.com/xklvTL7.png') no-repeat center center; /* Imagem do banner */
      background-size: cover;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }

    .banner h2 {
      background-color: rgba(0, 0, 0, 0.6);
      border: 2px solid #e50914;
      color: #e50914;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 24px;
      font-weight: bold;
    }

    /* Conteúdo principal */
    .content {
      padding: 30px 20px;
      max-width: 900px;
      margin: 0 auto;
    }

    /* Tag de destaque */
    .tag {
      display: inline-block;
      background-color: #e50914;
      color: white;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 12px;
      text-transform: uppercase;
      margin-bottom: 10px;
    }

    /* Item de produto */
    .produto-item {
      background-color: #1a1a1a;
      border: 1px solid #222;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 8px;
      position: relative;
    }

    .produto-titulo { font-size: 28px; font-weight: bold; margin: 10px 0; color: #e50914;}
    .produto-desc { color: #ccc; margin-bottom: 15px; }

    .precos { margin-bottom: 15px; }
    .preco-antigo { text-decoration: line-through; color: #888; font-size: 16px; margin-right: 10px; }
    .preco-atual { color: #0f0; font-size: 28px; font-weight: bold; } /* Preço atual em verde */

    .btn-comprar {
      background-color: #e50914;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 6px;
      cursor: pointer;
      transition: 0.3s;
    }

    .btn-comprar:hover {
      background-color: #b20710;
    }

    /* Botões de Admin no produto (só aparecem para admin) */
    .btn-delete-produto {
      background-color: #cc0000;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 12px;
      transition: 0.2s;
    }
    .btn-delete-produto:hover { background-color: #990000; }

    .btn-edit-produto {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
      position: absolute;
      top: 10px;
      right: 70px; /* Ajuste para não sobrepor o delete */
      font-size: 12px;
      transition: 0.2s;
    }
    .btn-edit-produto:hover { background-color: #0056b3; }


    /* Footer */
    footer {
      background-color: #111;
      text-align: center;
      padding: 15px;
      color: #777;
      margin-top: 40px;
      font-size: 14px;
    }

    /* Modals base */
    .modal {
      display: none; /* Escondido por padrão */
      position: fixed;
      z-index: 1000;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      justify-content: center;
      align-items: center;
      overflow: auto; /* Para modais altos em telas pequenas */
    }

    .modal-content {
      background-color: #111;
      padding: 25px;
      border-radius: 10px;
      text-align: center;
      width: 90%;
      max-width: 450px; /* Largura padrão */
      border: 2px solid #e50914; /* Borda vermelha para modal de compra */
      position: relative;
      animation: fadeIn 0.3s ease-out;
    }

    .modal-content.admin-modal {
        max-width: 700px; /* Mais largo para o painel de admin */
        border: 2px solid #0f0; /* Borda verde para o modal admin */
    }

    .modal-content h3 {
      color: #e50914;
      margin-bottom: 20px;
      font-size: 24px;
    }
    .modal-content.admin-modal h3 {
        color: #0f0; /* Título do modal admin verde */
    }

    .pix-key {
      background-color: #222;
      padding: 12px;
      border-radius: 6px;
      font-size: 16px;
      word-wrap: break-word; /* Quebra texto longo */
      margin-bottom: 20px;
      border: 1px solid #e50914;
    }

    .btn-confirmar {
      background-color: #e50914;
      border: none;
      color: white;
      padding: 12px 25px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      transition: 0.3s;
    }
    .btn-confirmar:hover { background-color: #b20710; }

    .mensagem-final {
      margin-top: 25px;
      color: #0f0;
      font-weight: bold;
      font-size: 18px;
      display: none;
    }

    .close-button {
      position: absolute;
      top: 10px;
      right: 20px;
      color: #aaa;
      font-size: 30px;
      font-weight: bold;
      cursor: pointer;
      transition: 0.2s;
    }
    .close-button:hover, .close-button:focus {
      color: #fff;
    }

    /* Estilos de Administração (dentro do modal) */
    .admin-tab-content h4 {
        color: #eee;
        margin-top: 25px;
        margin-bottom: 15px;
        font-size: 20px;
        border-bottom: 1px solid #333;
        padding-bottom: 5px;
    }

    .admin-section input[type="text"],
    .admin-section input[type="number"],
    .admin-section textarea {
      width: calc(100% - 20px);
      padding: 10px;
      margin-bottom: 10px;
      background-color: #222;
      border: 1px solid #333;
      color: #fff;
      border-radius: 4px;
      font-size: 15px;
    }

    .admin-section button {
      background-color: #0f0; /* Botão verde */
      color: #111;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin-right: 10px;
      transition: 0.3s;
      font-size: 15px;
    }

    .admin-section button:hover {
      background-color: #00cc00;
    }

    .admin-products-list, .admin-warnings-list {
      margin-top: 20px;
      max-height: 250px; /* Limita a altura para rolagem */
      overflow-y: auto; /* Adiciona barra de rolagem se necessário */
      padding-right: 10px; /* Espaço para a barra de rolagem */
      border-top: 1px solid #333;
      padding-top: 15px;
    }

    .admin-product-item, .warning-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #222;
      padding: 12px;
      border-radius: 5px;
      margin-bottom: 10px;
      border: 1px solid #333;
    }

    .admin-product-item span, .warning-item span {
      flex-grow: 1;
      text-align: left;
      font-size: 15px;
    }

    .admin-product-item button, .warning-item button {
      margin-left: 10px;
      padding: 5px 10px;
      font-size: 13px;
      flex-shrink: 0;
    }

    .admin-warning-message {
        background-color: #e50914;
        color: white;
        padding: 10px;
        border-radius: 5px;
        margin-bottom: 20px;
        text-align: center;
        font-weight: bold;
        font-size: 16px;
    }

    /* Estilos para as abas de administração */
    .admin-tabs {
        display: flex;
        margin-bottom: 20px;
        border-bottom: 1px solid #0f0;
        overflow-x: auto; /* Permite rolagem horizontal se muitas abas */
    }

    .admin-tab-button {
        background-color: #333;
        color: #0f0;
        padding: 10px 15px;
        border: none;
        cursor: pointer;
        border-top-left-radius: 8px;
        border-top-right-radius: 8px;
        margin-right: 5px;
        transition: background-color 0.3s, color 0.3s;
        flex-shrink: 0; /* Evita que os botões encolham */
    }

    .admin-tab-button.active {
        background-color: #0f0;
        color: #111;
    }

    .admin-tab-content {
        display: none;
        text-align: left;
        padding-top: 15px; /* Espaço após as abas */
    }

    .admin-tab-content.active {
        display: block;
    }

    /* Animação para modal */
    @keyframes fadeIn {
        from { opacity: 0; transform: scale(0.9); }
        to { opacity: 1; transform: scale(1); }
    }
  </style>
</head>
<body>

  <header>
    <div class="logo">HAX STORE</div>
    <div class="header-buttons">
        <button class="discord-btn" onclick="window.open('https://discord.gg/SEU_CONVITE_DISCORD', '_blank')">Entrar no Discord</button>
        <button id="adminPanelBtn" class="admin-panel-btn" style="display: none;">Painel de Administração</button>
        <button id="logoutBtn" class="logout-btn" style="display: none;">Sair</button>
    </div>
  </header>

  <div class="banner">
    <h2>Bem-vindo à HAX STORE!</h2>
  </div>

  <div class="content">
    <div id="warnings-container"></div>
    <div id="products-container"></div>
  </div>

  <footer>
    &copy; 2025 HAX STORE. Todos os direitos reservados.
  </footer>

  <div class="modal" id="pixModal">
    <div class="modal-content">
      <span class="close-button" onclick="closePixModal()">&times;</span>
      <h3>Pagamento via PIX</h3>
      <p>Escaneie o QR Code ou use a chave PIX abaixo:</p>
      <div class="pix-key" id="pixChave"></div>
      <button class="btn-confirmar" onclick="confirmarPagamento()">Já realizei o pagamento</button>
      <div class="mensagem-final" id="mensagemFinal">HAX STORE - ENVIE O COMPROVANTE NO TICKET DO DISCORD!</div>
    </div>
  </div>

  <div class="modal" id="adminModal">
    <div class="modal-content admin-modal">
        <span class="close-button" onclick="closeAdminModal()">&times;</span>
        <h3>Painel de Administração</h3>

        <div class="admin-tabs">
            <button class="admin-tab-button active" onclick="openAdminTab(event, 'manage-products')">Gerenciar Produtos</button>
            <button class="admin-tab-button" onclick="openAdminTab(event, 'manage-warnings')">Gerenciar Avisos</button>
            <button class="admin-tab-button" onclick="openAdminTab(event, 'manage-pix')">Configurar PIX</button>
        </div>

        <div id="manage-products" class="admin-tab-content active admin-section">
            <h4>Adicionar/Editar Produto</h4>
            <input type="hidden" id="productIdToEdit">
            <input type="text" id="productTitle" placeholder="Título do Produto" required>
            <textarea id="productDesc" placeholder="Descrição do Produto" rows="3"></textarea>
            <input type="number" id="productOldPrice" placeholder="Preço Antigo (Ex: 30.00)" step="0.01">
            <input type="number" id="productNewPrice" placeholder="Preço Atual (Ex: 10.00)" step="0.01" required>
            <button onclick="saveProduct()">Salvar Produto</button>
            <button onclick="clearProductForm()">Limpar Formulário</button>

            <h4>Produtos Existentes</h4>
            <div id="admin-products-list"></div>
        </div>

        <div id="manage-warnings" class="admin-tab-content admin-section">
            <h4>Gerenciar Avisos</h4>
            <input type="text" id="warningMessage" placeholder="Nova mensagem de aviso">
            <button onclick="addWarning()">Adicionar Aviso</button>
            <div id="admin-warnings-list"></div>
        </div>

        <div id="manage-pix" class="admin-tab-content admin-section">
            <h4>Chave PIX Atual</h4>
            <input type="text" id="currentPixKey" placeholder="Chave PIX atual" readonly>
            <h4>Nova Chave PIX</h4>
            <input type="text" id="newPixKey" placeholder="Nova Chave PIX">
            <button onclick="updatePixKey()">Salvar Chave PIX</button>
        </div>
    </div>
  </div>

  <script>
    // --- Configuração do Firebase ---
    // ATENÇÃO: Verifique se estas são as suas chaves corretas!
   const firebaseConfig = {
  apiKey: "AIzaSyAx5VNBlcPXveA1xawirSjRVWDNaKdNRmc",
  authDomain: "haxstore-a250a.firebaseapp.com",
  projectId: "haxstore-a250a",
  storageBucket: "haxstore-a250a.firebasestorage.app",
  messagingSenderId: "39538757064",
  appId: "1:39538757064:web:7f45d2cba626b6333ac4fd",
  measurementId: "G-3D42M9L1HF"
};

    // Inicialize o Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // --- Referências aos elementos DOM ---
    const productsContainer = document.getElementById('products-container');
    const adminPanelBtn = document.getElementById('adminPanelBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const adminModal = document.getElementById('adminModal');
    const adminProductsList = document.getElementById('admin-products-list');
    const warningsContainer = document.getElementById('warnings-container');
    const adminWarningsList = document.getElementById('admin-warnings-list');
    const pixChaveDisplay = document.getElementById('pixChave');
    const newPixKeyInput = document.getElementById('newPixKey');
    const currentPixKeyDisplay = document.getElementById('currentPixKey');

    // --- Chaves para o localStorage (apenas para status de login local) ---
    const LS_IS_ADMIN_KEY = 'haxstore_isAdmin';
    const LS_LOGGED_USER_KEY = 'haxstore_logged_user';

    // --- Autenticação (Apenas para simular login de admin localmente) ---
    const ADMIN_USERNAME = 'jhow';
    const ADMIN_PASSWORD = 'modder'; // Senha fixa no código, insegura

    function checkAdminStatus() {
        return localStorage.getItem(LS_IS_ADMIN_KEY) === 'true';
    }

    function checkLoggedInStatus() {
        return localStorage.getItem(LS_LOGGED_USER_KEY) === 'true';
    }

    // --- Funções de Inicialização ---
    document.addEventListener('DOMContentLoaded', () => {
        // Se o usuário não está logado, redireciona para a página de login
        if (!checkLoggedInStatus()) {
            window.location.href = 'index.html';
            return; // Interrompe a execução para evitar que o resto do script tente carregar dados
        }

        // Se está logado, verifica status de admin e exibe botões
        const isAdmin = checkAdminStatus();
        if (isAdmin) {
            adminPanelBtn.style.display = 'block';
        } else {
            adminPanelBtn.style.display = 'none';
        }
        logoutBtn.style.display = 'block'; // O botão de sair aparece para qualquer usuário logado

        // Carrega e renderiza o conteúdo da loja
        renderProducts();
        renderWarnings();
        updatePixKeyDisplay();
    });

    // --- Funções de Modal de Compra (PIX) ---
    function abrirModal() {
        if (!checkLoggedInStatus()) {
            alert('Você precisa estar logado para realizar uma compra.');
            window.location.href = 'index.html'; // Redireciona para o login
            return;
        }
        updatePixKeyDisplay();
        document.getElementById('pixModal').style.display = 'flex';
        document.getElementById('mensagemFinal').style.display = "none";
    }

    function closePixModal() {
        document.getElementById('pixModal').style.display = 'none';
        document.getElementById('mensagemFinal').style.display = "none";
    }

    function confirmarPagamento() {
        const mensagem = document.getElementById('mensagemFinal');
        mensagem.style.display = 'block';
    }

    // --- Funções do Modal de Administração ---
    adminPanelBtn.addEventListener('click', () => {
        if (checkAdminStatus()) {
            adminModal.style.display = 'flex';
            openAdminTab(null, 'manage-products'); // Abre a primeira aba por padrão
            loadAdminProducts(); // Carrega produtos na lista de admin
            loadAdminWarnings(); // Carrega avisos na lista de admin
            loadPixKeyForAdmin(); // Carrega chave PIX no campo de admin
        } else {
            alert('Acesso negado. Você não tem permissões de administrador.');
        }
    });

    function closeAdminModal() {
      adminModal.style.display = 'none';
    }

    // Botão de Logout
    logoutBtn.addEventListener('click', () => {
        if (confirm('Tem certeza que deseja sair?')) {
            localStorage.removeItem(LS_IS_ADMIN_KEY);
            localStorage.removeItem(LS_LOGGED_USER_KEY);
            alert('Sessão encerrada. Redirecionando para o login.');
            window.location.href = 'index.html';
        }
    });

    window.addEventListener('click', function(event) {
      if (event.target == document.getElementById('pixModal')) {
        closePixModal();
      }
      if (event.target == document.getElementById('adminModal')) {
        closeAdminModal();
      }
    });

    // --- Funções de Gerenciamento de Produtos (Firestore) ---

    // Listener para produtos em tempo real
    db.collection('products').onSnapshot((snapshot) => {
        const products = [];
        snapshot.forEach(doc => {
            products.push({ id: doc.id, ...doc.data() });
        });
        renderProducts(products);
        loadAdminProducts(products); // Atualiza também a lista no admin modal
    }, (error) => {
        console.error("Erro ao obter produtos: ", error);
        productsContainer.innerHTML = '<p style="text-align: center; color: #f00;">Erro ao carregar produtos. Verifique sua conexão ou as regras do Firebase.</p>';
    });

    // Renderiza produtos na parte principal da loja (visível para o usuário)
    function renderProducts(products) {
        productsContainer.innerHTML = '';
        const isAdmin = checkAdminStatus();

        if (products.length === 0) {
            productsContainer.innerHTML = '<p style="text-align: center; color: #ccc; padding: 20px;">Nenhum produto disponível no momento.</p>';
            if (isAdmin) {
                productsContainer.innerHTML += '<p style="text-align: center; color: #0f0;">Como administrador, você pode adicionar produtos através do "Painel de Administração".</p>';
            }
            return;
        }

        products.forEach((product) => {
          const productDiv = document.createElement('div');
          productDiv.className = 'produto-item';
          const adminButtons = isAdmin ? `
            <button class="btn-edit-produto" onclick="editProduct('${product.id}')">Editar</button>
            <button class="btn-delete-produto" onclick="deleteProduct('${product.id}')">Apagar</button>
          ` : '';

          productDiv.innerHTML = `
            ${adminButtons}
            <span class="tag">Em destaque</span>
            <h1 class="produto-titulo">${product.title}</h1>
            <p class="produto-desc">${product.description}</p>
            <div class="precos">
              ${product.oldPrice && product.oldPrice > 0 ? `<span class="preco-antigo">R$ ${parseFloat(product.oldPrice).toFixed(2).replace('.', ',')}</span>` : ''}
              <span class="preco-atual">R$ ${parseFloat(product.newPrice).toFixed(2).replace('.', ',')}</span>
            </div>
            <button class="btn-comprar">Comprar agora</button>
          `;
          productsContainer.appendChild(productDiv);
        });

        document.querySelectorAll('.btn-comprar').forEach(button => {
          button.addEventListener('click', abrirModal);
        });
    }

    // Carrega produtos na lista dentro do painel de administração (só admin)
    function loadAdminProducts(products) {
        if (!checkAdminStatus()) return;

        adminProductsList.innerHTML = '';
        if (products.length === 0) {
            adminProductsList.innerHTML = '<p style="text-align: center; color: #ccc;">Nenhum produto adicionado ainda.</p>';
            return;
        }

        products.forEach(product => {
            const productItem = document.createElement('div');
            productItem.className = 'admin-product-item';
            productItem.innerHTML = `
                <span>${product.title} - R$ ${parseFloat(product.newPrice).toFixed(2).replace('.', ',')}</span>
                <div>
                    <button onclick="editProduct('${product.id}')">Editar</button>
                    <button onclick="deleteProduct('${product.id}')">Apagar</button>
                </div>
            `;
            adminProductsList.appendChild(productItem);
        });
    }

    async function saveProduct() {
        if (!checkAdminStatus()) {
            alert('Acesso negado.');
            return;
        }
        const productId = document.getElementById('productIdToEdit').value;
        const title = document.getElementById('productTitle').value;
        const description = document.getElementById('productDesc').value;
        const oldPrice = parseFloat(document.getElementById('productOldPrice').value || 0);
        const newPrice = parseFloat(document.getElementById('productNewPrice').value);

        if (!title || !newPrice) {
            alert('Título e Preço Atual são obrigatórios.');
            return;
        }

        const productData = { title, description, oldPrice, newPrice };

        try {
            if (productId) {
                // Editar produto existente
                await db.collection('products').doc(productId).update(productData);
                alert('Produto atualizado com sucesso!');
            } else {
                // Adicionar novo produto
                await db.collection('products').add(productData);
                alert('Produto adicionado com sucesso!');
            }
            clearProductForm();
        } catch (e) {
            console.error("Erro ao salvar produto: ", e);
            alert("Erro ao salvar produto. Verifique suas regras do Firestore e conexão.");
        }
    }

    async function editProduct(id) {
        if (!checkAdminStatus()) {
            alert('Acesso negado.');
            return;
        }
        try {
            const doc = await db.collection('products').doc(id).get();
            if (doc.exists) {
                const product = doc.data();
                document.getElementById('productIdToEdit').value = id;
                document.getElementById('productTitle').value = product.title;
                document.getElementById('productDesc').value = product.description;
                document.getElementById('productOldPrice').value = product.oldPrice;
                document.getElementById('productNewPrice').value = product.newPrice;
                // Abre a aba de gerenciar produtos no modal
                openAdminTab(null, 'manage-products');
                adminModal.style.display = 'flex';
            } else {
                alert('Produto não encontrado.');
            }
        } catch (e) {
            console.error("Erro ao carregar produto para edição: ", e);
            alert("Erro ao carregar produto para edição.");
        }
    }

    async function deleteProduct(id) {
        if (!checkAdminStatus()) {
            alert('Acesso negado.');
            return;
        }
        if (confirm('Tem certeza que deseja apagar este produto?')) {
            try {
                await db.collection('products').doc(id).delete();
                alert('Produto apagado com sucesso!');
            } catch (e) {
                console.error("Erro ao apagar produto: ", e);
                alert("Erro ao apagar produto. Verifique suas regras do Firestore e conexão.");
            }
        }
    }

    function clearProductForm() {
        document.getElementById('productIdToEdit').value = '';
        document.getElementById('productTitle').value = '';
        document.getElementById('productDesc').value = '';
        document.getElementById('productOldPrice').value = '';
        document.getElementById('productNewPrice').value = '';
    }

    // --- Funções de Gerenciamento de Avisos (Firestore) ---

    // Listener para avisos em tempo real
    db.collection('warnings').onSnapshot((snapshot) => {
        const warnings = [];
        snapshot.forEach(doc => {
            warnings.push({ id: doc.id, ...doc.data() });
        });
        renderWarnings(warnings);
        loadAdminWarnings(warnings); // Atualiza também a lista no admin modal
    }, (error) => {
        console.error("Erro ao obter avisos: ", error);
        warningsContainer.innerHTML = '<p style="text-align: center; color: #f00;">Erro ao carregar avisos. Verifique sua conexão ou as regras do Firebase.</p>';
    });

    // Renderiza avisos na parte principal da loja
    function renderWarnings(warnings) {
        warningsContainer.innerHTML = '';
        if (warnings.length === 0) {
            warningsContainer.innerHTML = '<p style="text-align: center; color: #ccc; padding: 20px;">Nenhum aviso no momento.</p>';
            return;
        }
        warnings.forEach(warning => {
            const warningDiv = document.createElement('div');
            warningDiv.className = 'admin-warning-message';
            warningDiv.textContent = warning.message;
            warningsContainer.appendChild(warningDiv);
        });
    }

    // Carrega avisos na lista dentro do painel de administração
    function loadAdminWarnings(warnings) {
        if (!checkAdminStatus()) return;

        adminWarningsList.innerHTML = '';
        if (warnings.length === 0) {
            adminWarningsList.innerHTML = '<p style="text-align: center; color: #ccc;">Nenhum aviso adicionado ainda.</p>';
            return;
        }
        warnings.forEach(warning => {
            const warningItem = document.createElement('div');
            warningItem.className = 'warning-item';
            warningItem.innerHTML = `
                <span>${warning.message}</span>
                <button onclick="deleteWarning('${warning.id}')" style="background-color: #cc0000;">Apagar</button>
            `;
            adminWarningsList.appendChild(warningItem);
        });
    }

    async function addWarning() {
        if (!checkAdminStatus()) {
            alert('Acesso negado.');
            return;
        }
        const message = document.getElementById('warningMessage').value;
        if (!message) {
            alert('A mensagem de aviso não pode ser vazia.');
            return;
        }
        try {
            await db.collection('warnings').add({ message });
            alert('Aviso adicionado com sucesso!');
            document.getElementById('warningMessage').value = '';
        } catch (e) {
            console.error("Erro ao adicionar aviso: ", e);
            alert("Erro ao adicionar aviso. Verifique suas regras do Firestore e conexão.");
        }
    }

    async function deleteWarning(id) {
        if (!checkAdminStatus()) {
            alert('Acesso negado.');
            return;
        }
        if (confirm('Tem certeza que deseja apagar este aviso?')) {
            try {
                await db.collection('warnings').doc(id).delete();
                alert('Aviso apagado com sucesso!');
            } catch (e) {
                console.error("Erro ao apagar aviso: ", e);
                alert("Erro ao apagar aviso. Verifique suas regras do Firestore e conexão.");
            }
        }
    }

    // --- Funções de Gerenciamento da Chave PIX (Firestore) ---

    // Listener para a chave PIX em tempo real (assumindo um único documento 'pixKeyDoc')
    db.collection('pixKey').doc('mainPix').onSnapshot((doc) => {
        if (doc.exists) {
            const pixData = doc.data();
            pixChaveDisplay.textContent = pixData.key || 'Nenhuma chave PIX configurada.';
            if (checkAdminStatus()) {
                currentPixKeyDisplay.value = pixData.key || '';
            }
        } else {
            pixChaveDisplay.textContent = 'Nenhuma chave PIX configurada.';
            if (checkAdminStatus()) {
                currentPixKeyDisplay.value = '';
            }
        }
    }, (error) => {
        console.error("Erro ao obter chave PIX: ", error);
        pixChaveDisplay.textContent = 'Erro ao carregar chave PIX.';
    });

    function updatePixKeyDisplay() {
        // Esta função agora é redundantemente chamada no DOMContentLoaded,
        // mas o listener do Firestore já a atualiza automaticamente.
        // Apenas para garantir, se precisar de um acionamento manual:
        // O listener acima já cuida disso em tempo real.
    }

    async function updatePixKey() {
        if (!checkAdminStatus()) {
            alert('Acesso negado.');
            return;
        }
        const newKey = newPixKeyInput.value;
        if (!newKey) {
            alert('A nova chave PIX não pode ser vazia.');
            return;
        }
        try {
            // Usa set com merge: true para criar ou atualizar o documento sem apagar outros campos
            await db.collection('pixKey').doc('mainPix').set({ key: newKey }, { merge: true });
            alert('Chave PIX atualizada com sucesso!');
            newPixKeyInput.value = '';
        } catch (e) {
            console.error("Erro ao atualizar chave PIX: ", e);
            alert("Erro ao atualizar chave PIX. Verifique suas regras do Firestore e conexão.");
        }
    }

    function loadPixKeyForAdmin() {
        // Esta função é chamada quando o modal admin é aberto.
        // O listener do Firestore já atualiza o campo currentPixKeyDisplay automaticamente.
        // Não é necessário buscar novamente aqui, a menos que você queira um comportamento diferente.
    }


    // --- Funções de Abas do Painel de Administração ---
    function openAdminTab(evt, tabName) {
        const tabContent = document.querySelectorAll('.admin-tab-content');
        tabContent.forEach(tab => tab.style.display = 'none');

        const tabButtons = document.querySelectorAll('.admin-tab-button');
        tabButtons.forEach(btn => btn.classList.remove('active'));

        document.getElementById(tabName).style.display = 'block';
        if (evt) {
            evt.currentTarget.classList.add('active');
        } else { // Se chamado sem evento (ex: ao abrir modal), ativa o botão manualmente
            const defaultButton = document.querySelector(`.admin-tab-button[onclick*="${tabName}"]`);
            if (defaultButton) defaultButton.classList.add('active');
        }
    }

  </script>
</body>
</html>